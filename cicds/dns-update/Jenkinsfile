label='jk-worker-pod'
podTemplate(
    label: label,
    containers: [
        containerTemplate(
            name: 'jnlp',
            
            image: 'ghcr.io/gasilva-clgx/jnlp-slave:latest',
            imagePullPolicy: "Always", //"IfNotPresent",
            //runAsUser: 'root',
            workingDir: '/home/jenkins',
            resourceRequestCpu: '100m',
            resourceLimitCpu: '2000m',
            resourceRequestMemory: '1Gi',
            resourceLimitMemory: '2Gi',
        )
    ],
    volumes: [
        //hostPathVolume(hostPath: '/usr/bin/docker', mountPath: '/usr/bin/docker'),
        //hostPathVolume(hostPath: '/var/run/docker.sock', mountPath: '/var/run/docker.sock')
    ]
) {
    node(label) {

        stage('Fetch DNS Config file') {
            withCredentials([string(credentialsId: 'vault_token', variable: 'VAULT_TOKEN')]) {
                sh "env | sort"
                sh 'id'
                sh 'go version'
                sh 'java -version'
                sh 'jq'
                sh 'ls -lhrt /usr/local/bin'
                sh 'ls -lhrt /usr/local/bin/vault'
                def data = readYaml(text: sh(returnStdout: true, script: "vault kv get --format yaml  kv/root_users/piter"))
                echo '2'
                echo data.data.data.user
            }

        }
        
    }
}
